<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamera ve Bildirim İzin Yönetimi</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #f0f0f0; }
        video { width: 80%; max-width: 600px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); background: #000; }
        .controls { margin-top: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; background: #007bff; color: white; }
    </style>
</head>
<body>

    <h2>Kamera ve Bildirim Sistemi</h2>
    
    <video id="cameraFeed" autoplay playsinline></video>

    <div class="controls">
        <button id="startBtn">Sistemi Başlat ve İzinleri İste</button>
    </div>

    <script>
        const videoElement = document.getElementById('cameraFeed');
        const startBtn = document.getElementById('startBtn');

        // ANA FONKSİYON: Kamera ve Bildirim İzinlerini Yönetir
        async function initSystem() {
            try {
                // --- 1. KISIM: KAMERA İZNİ AÇIKLAMASI ---
                // navigator.mediaDevices.getUserMedia komutu tarayıcıya "Kamerayı açayım mı?" sorusunu sordurur.
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: false 
                });
                
                // İzin verilirse gelen görüntü (stream) video elementine bağlanır.
                videoElement.srcObject = stream;
                console.log("Kamera erişimi başarılı.");

                // --- 2. KISIM: BİLDİRİM İZNİ AÇIKLAMASI ---
                // Notification.requestPermission() kullanıcıya bildirim gönderip gönderemeyeceğimizi sorar.
                if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                    const permission = await Notification.requestPermission();
                    
                    if (permission === "granted") {
                        new Notification("Sistem Hazır!", { body: "Kamera ve bildirim izinleri başarıyla tanımlandı." });
                    }
                } else if (Notification.permission === "granted") {
                    new Notification("Yeniden Merhaba!", { body: "Kamera şu an aktif." });
                }

            } catch (err) {
                // --- 3. KISIM: İZİN REDDEDİLİRSE ---
                // Kullanıcı "Engelle" derse veya donanım bulunamazsa bu blok çalışır.
                console.error("Hata oluştu veya izin verilmedi:", err);
                alert("Lütfen kamera ve bildirim izinlerini tarayıcı ayarlarından onaylayın.");
            }
        }

        // Butona tıklandığında süreci başlat
        startBtn.addEventListener('click', () => {
            initSystem();
        });
    </script>
</body>
</html>
